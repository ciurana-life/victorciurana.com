### Get google cloud command line
### install docker
docker pull nginx:1.19.0-alpine

### re-make the image
(local)
docker-compose -f docker-compose.prod.yml build
docker tag victorciuranacom_web eu.gcr.io/victor-ciurana-com/victorciuranacom_web
docker push eu.gcr.io/victor-ciurana-com/victorciuranacom_web
(server)
docker pull eu.gcr.io/victor-ciurana-com/victorciuranacom_web:latest
docker-compose -f docker-compose.prod.yml up -d --build
docker ps

### Initial
docker tag victorciuranacom_nginx-proxy eu.gcr.io/victor-ciurana-com/victorciuranacom_nginx-proxy
docker tag victorciuranacom_nginx eu.gcr.io/victor-ciurana-com/victorciuranacom_nginx
docker tag victorciuranacom_web eu.gcr.io/victor-ciurana-com/victorciuranacom_web
docker tag jrcs/letsencrypt-nginx-proxy-companion eu.gcr.io/victor-ciurana-com/jrcs/letsencrypt-nginx-proxy-companion
docker tag redis:alpine eu.gcr.io/victor-ciurana-com/redis-v
docker tag postgres:12.0-alpine eu.gcr.io/victor-ciurana-com/postgres

docker push eu.gcr.io/victor-ciurana-com/victorciuranacom_nginx-proxy
docker push eu.gcr.io/victor-ciurana-com/victorciuranacom_nginx
docker push eu.gcr.io/victor-ciurana-com/victorciuranacom_web
docker push eu.gcr.io/victor-ciurana-com/jrcs/letsencrypt-nginx-proxy-companion
docker push eu.gcr.io/victor-ciurana-com/redis-v
docker push eu.gcr.io/victor-ciurana-com/postgres

(server)
gcloud auth login
gcloud auth application-default login
gcloud auth configure-docker

docker pull eu.gcr.io/victor-ciurana-com/victorciuranacom_nginx-proxy:latest
docker pull eu.gcr.io/victor-ciurana-com/victorciuranacom_nginx:latest
docker pull eu.gcr.io/victor-ciurana-com/victorciuranacom_web:latest
docker pull eu.gcr.io/victor-ciurana-com/jrcs/letsencrypt-nginx-proxy-companion:latest
docker pull eu.gcr.io/victor-ciurana-com/redis-v:latest
docker pull eu.gcr.io/victor-ciurana-com/postgres:latest

# The first upload needs to migrate , but for prevention of errors lets call it always?
docker-compose -f docker-compose.prod.yml up -d
docker-compose exec web python manage.py migrate --no-input

# Supposedly running the build will update it ??
docker-compose -f docker-compose.prod.yml up -d

# To verify the update run
docker ps


